# 路由选择

* 第一个周期：WRR算法，严格均匀分配。

    * 由于第一个周期无历史统计信息，故所有节点均为初始化信息：门限limit=0，负载loadx=1.0，成功率负载okload=1.0，延时负载delayload=1.0，成功率okrate=1.0，平均延时avgtm=1。

    * 算法效果：均匀并一定分配某就近接入的节点。该周期内服务器不能感知节点宕机与否、请求门限大小或任何统计信息；静态权重也不起任何作用。


* 第N个周期：WRR算法，PreAll*LoadX（已分配数*负载）为节点分配指标。

    * 分配的节点必须是就近接入节点，否则返回远程节点失败码。

    * 当节点本周期的总请求量未超过门限，并有效错误率未超过预设最低错误率时，分配该节点。预取数设置为预测本进程本周期内的成功请求数。过期时间设置为距离本次周期结束时间。

    * 当节点本周期的总请求未超过门限；并有效错误率超过预设最低错误率时，分配该节点。预取数设置为1。过期时间设置为距离本次周期结束时间。

    * 当节点本周期的请求量超过门限，并错误率未超过预设最低错误率时，分配该节点。预取数设置为1。过期时间设置为距离本次周期结束时间。

    * 当节点本周期的请求量超过门限，并错误率超过预设最低错误率时，判定该节点过载（压力故障）。这样处理可使：某被踢节点在刚恢复情况下，即使门限较低，只要错误率低于预设的错误率阀值，也仍然可以分配该节点（情形d）。


